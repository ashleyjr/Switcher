//-----------------------------------------------------------------------------
// Project: Switcher
// File: 	Pid.h	
// Brief:	Header file for PID controller 
//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------

#include <SI_C8051F850_Register_Enums.h>
#include <stdio.h>
#include "InitDevice.h"
#include "Pid.h"

//-----------------------------------------------------------------------------
// Global CONSTANTS
//-----------------------------------------------------------------------------

#define SYSCLK      24500000           // SYSCLK frequency in Hz
#define BAUDRATE      115200           // Baud rate of UART in bps

//-----------------------------------------------------------------------------
// Function PROTOTYPES
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
// Global Variables
//-----------------------------------------------------------------------------
U16 CEX0_Compare_Value;       // Holds current PCA compare value
//-----------------------------------------------------------------------------
// MAIN Routine
//-----------------------------------------------------------------------------

void main (void){
	uint16_t	pwm;
	SCON0_TI = 1;                       	//This STDIO library requres TI to be set for prints to occur
	enter_DefaultMode_from_RESET();
	pidInit();
	// Configure initial PWM duty cycle = 50%
	CEX0_Compare_Value = 0;
	while (1){

		CEX0_Compare_Value = ADC0 << 6;
		printf("%d,%hu mV\n",ADC0,CEX0_Compare_Value);
		pwm = pidUpdate(pwm);
	}
}
//-----------------------------------------------------------------------------
// End Of File
//-----------------------------------------------------------------------------
